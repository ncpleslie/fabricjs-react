{"version":3,"file":"index.modern.js","sources":["../src/defaultShapes.tsx","../src/editor.tsx","../src/index.tsx"],"sourcesContent":["export const STROKE = '#000000'\r\nexport const FILL = 'rgba(255, 255, 255, 0.0)'\r\n\r\nexport const CIRCLE = {\r\n  radius: 20,\r\n  left: 100,\r\n  top: 100,\r\n  fill: FILL,\r\n  stroke: STROKE\r\n}\r\n\r\nexport const RECTANGLE = {\r\n  left: 100,\r\n  top: 100,\r\n  fill: FILL,\r\n  stroke: STROKE,\r\n  width: 40,\r\n  height: 40,\r\n  angle: 0\r\n}\r\n\r\nexport const LINE = {\r\n  points: [50, 100, 200, 200],\r\n  options: {\r\n    left: 170,\r\n    top: 150,\r\n    stroke: STROKE\r\n  }\r\n}\r\n\r\nexport const TEXT = {\r\n  type: 'text',\r\n  left: 100,\r\n  top: 100,\r\n  fontSize: 16,\r\n  fontFamily: 'Arial',\r\n  fill: STROKE\r\n}\r\n","import { fabric } from 'fabric'\r\nimport { CIRCLE, RECTANGLE, LINE, TEXT, FILL, STROKE } from './defaultShapes'\r\nimport { useEffect, useState } from 'react'\r\n\r\nexport interface FabricJSEditor {\r\n  canvas: fabric.Canvas\r\n  addCircle: () => void\r\n  addRectangle: () => void\r\n  addLine: () => void\r\n  addText: (text: string) => void\r\n  updateText: (text: string) => void\r\n  deleteAll: () => void\r\n  deleteSelected: () => void\r\n  fillColor: string\r\n  strokeColor: string\r\n  setFillColor: (color: string) => void\r\n  setStrokeColor: (color: string) => void\r\n  zoomIn: () => void\r\n  zoomOut: () => void\r\n}\r\n\r\n/**\r\n * Creates editor\r\n */\r\nconst buildEditor = (\r\n  canvas: fabric.Canvas,\r\n  fillColor: string,\r\n  strokeColor: string,\r\n  _setFillColor: (color: string) => void,\r\n  _setStrokeColor: (color: string) => void,\r\n  scaleStep: number\r\n): FabricJSEditor => {\r\n  return {\r\n    canvas,\r\n    addCircle: () => {\r\n      const object = new fabric.Circle({\r\n        ...CIRCLE,\r\n        fill: fillColor,\r\n        stroke: strokeColor\r\n      })\r\n      canvas.add(object)\r\n    },\r\n    addRectangle: () => {\r\n      const object = new fabric.Rect({\r\n        ...RECTANGLE,\r\n        fill: fillColor,\r\n        stroke: strokeColor\r\n      })\r\n      canvas.add(object)\r\n    },\r\n    addLine: () => {\r\n      const object = new fabric.Line(LINE.points, {\r\n        ...LINE.options,\r\n        stroke: strokeColor\r\n      })\r\n      canvas.add(object)\r\n    },\r\n    addText: (text: string) => {\r\n      // use stroke in text fill, fill default is most of the time transparent\r\n      const object = new fabric.Textbox(text, { ...TEXT, fill: strokeColor })\r\n      object.set({ text: text })\r\n      canvas.add(object)\r\n    },\r\n    updateText: (text: string) => {\r\n      const objects: any[] = canvas.getActiveObjects()\r\n      if (objects.length && objects[0].type === TEXT.type) {\r\n        const textObject: fabric.Textbox = objects[0]\r\n        textObject.set({ text })\r\n        canvas.renderAll()\r\n      }\r\n    },\r\n    deleteAll: () => {\r\n      canvas.getObjects().forEach((object) => canvas.remove(object))\r\n      canvas.discardActiveObject()\r\n      canvas.renderAll()\r\n    },\r\n    deleteSelected: () => {\r\n      canvas.getActiveObjects().forEach((object) => canvas.remove(object))\r\n      canvas.discardActiveObject()\r\n      canvas.renderAll()\r\n    },\r\n    fillColor,\r\n    strokeColor,\r\n    setFillColor: (fill: string) => {\r\n      _setFillColor(fill)\r\n      canvas.getActiveObjects().forEach((object) => object.set({ fill }))\r\n      canvas.renderAll()\r\n    },\r\n    setStrokeColor: (stroke: string) => {\r\n      _setStrokeColor(stroke)\r\n      canvas.getActiveObjects().forEach((object) => {\r\n        if (object.type === TEXT.type) {\r\n          // use stroke in text fill\r\n          object.set({ fill: stroke })\r\n          return\r\n        }\r\n        object.set({ stroke })\r\n      })\r\n      canvas.renderAll()\r\n    },\r\n    zoomIn: () => {\r\n      const zoom = canvas.getZoom()\r\n      canvas.setZoom(zoom / scaleStep)\r\n    },\r\n    zoomOut: () => {\r\n      const zoom = canvas.getZoom()\r\n      canvas.setZoom(zoom * scaleStep)\r\n    }\r\n  }\r\n}\r\n\r\ninterface FabricJSEditorState {\r\n  editor?: FabricJSEditor\r\n}\r\n\r\ninterface FabricJSEditorHook extends FabricJSEditorState {\r\n  selectedObjects?: fabric.Object[]\r\n  onReady: (canvas: fabric.Canvas) => void\r\n}\r\n\r\ninterface FabricJSEditorHookProps {\r\n  defaultFillColor?: string\r\n  defaultStrokeColor?: string\r\n  scaleStep?: number\r\n}\r\n\r\nconst useFabricJSEditor = (\r\n  props: FabricJSEditorHookProps = {}\r\n): FabricJSEditorHook => {\r\n  const scaleStep = props.scaleStep || 0.5\r\n  const { defaultFillColor, defaultStrokeColor } = props\r\n  const [canvas, setCanvas] = useState<null | fabric.Canvas>(null)\r\n  const [fillColor, setFillColor] = useState<string>(defaultFillColor || FILL)\r\n  const [strokeColor, setStrokeColor] = useState<string>(\r\n    defaultStrokeColor || STROKE\r\n  )\r\n  const [selectedObjects, setSelectedObject] = useState<fabric.Object[]>([])\r\n  useEffect(() => {\r\n    const bindEvents = (canvas: fabric.Canvas) => {\r\n      canvas.on('selection:cleared', () => {\r\n        setSelectedObject([])\r\n      })\r\n      canvas.on('selection:created', (e: any) => {\r\n        setSelectedObject(e.selected)\r\n      })\r\n      canvas.on('selection:updated', (e: any) => {\r\n        setSelectedObject(e.selected)\r\n      })\r\n    }\r\n    if (canvas) {\r\n      bindEvents(canvas)\r\n    }\r\n  }, [canvas])\r\n\r\n  return {\r\n    selectedObjects,\r\n    onReady: (canvasReady: fabric.Canvas): void => {\r\n      console.log('Fabric canvas ready')\r\n      setCanvas(canvasReady)\r\n    },\r\n    editor: canvas\r\n      ? buildEditor(\r\n          canvas,\r\n          fillColor,\r\n          strokeColor,\r\n          setFillColor,\r\n          setStrokeColor,\r\n          scaleStep\r\n        )\r\n      : undefined\r\n  }\r\n}\r\n\r\nexport { buildEditor, useFabricJSEditor, FabricJSEditorHook }\r\n","import React, { useEffect, useRef } from 'react'\r\nimport { fabric } from 'fabric'\r\nimport { useFabricJSEditor, FabricJSEditor, FabricJSEditorHook } from './editor'\r\n\r\nexport interface Props {\r\n  className?: string\r\n  onReady?: (canvas: fabric.Canvas) => void\r\n}\r\n\r\n/**\r\n * Fabric canvas as component\r\n */\r\nconst FabricJSCanvas = ({ className, onReady }: Props) => {\r\n  const canvasEl = useRef(null)\r\n  const canvasElParent = useRef<HTMLDivElement>(null)\r\n  useEffect(() => {\r\n    const canvas = new fabric.Canvas(canvasEl.current)\r\n    const setCurrentDimensions = () => {\r\n      canvas.setHeight(canvasElParent.current?.clientHeight || 0)\r\n      canvas.setWidth(canvasElParent.current?.clientWidth || 0)\r\n      canvas.renderAll()\r\n    }\r\n    const resizeCanvas = () => {\r\n      setCurrentDimensions()\r\n    }\r\n    setCurrentDimensions()\r\n\r\n    window.addEventListener('resize', resizeCanvas, false)\r\n\r\n    if (onReady) {\r\n      onReady(canvas)\r\n    }\r\n\r\n    return () => {\r\n      canvas.dispose()\r\n      window.removeEventListener('resize', resizeCanvas)\r\n    }\r\n  }, [])\r\n  return (\r\n    <div ref={canvasElParent} className={className}>\r\n      <canvas ref={canvasEl} />\r\n    </div>\r\n  )\r\n}\r\n\r\nexport { FabricJSEditor, FabricJSCanvas, FabricJSEditorHook, useFabricJSEditor }\r\n"],"names":["STROKE","FILL","CIRCLE","radius","left","top","fill","stroke","RECTANGLE","width","height","angle","LINE","points","options","TEXT","type","fontSize","fontFamily","buildEditor","canvas","fillColor","strokeColor","_setFillColor","_setStrokeColor","scaleStep","addCircle","object","fabric","Circle","add","addRectangle","Rect","addLine","Line","addText","text","Textbox","set","updateText","objects","getActiveObjects","length","textObject","renderAll","deleteAll","getObjects","forEach","remove","discardActiveObject","deleteSelected","setFillColor","setStrokeColor","zoomIn","zoom","getZoom","setZoom","zoomOut","useFabricJSEditor","props","defaultFillColor","defaultStrokeColor","useState","setCanvas","selectedObjects","setSelectedObject","useEffect","bindEvents","on","e","selected","onReady","canvasReady","console","log","editor","undefined","FabricJSCanvas","className","canvasEl","useRef","canvasElParent","Canvas","current","setCurrentDimensions","setHeight","clientHeight","setWidth","clientWidth","resizeCanvas","window","addEventListener","dispose","removeEventListener","React","ref"],"mappings":"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"}